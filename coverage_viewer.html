<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="utf-8" />
  <title>Mobile Operator's Coverage</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- MarkerCluster -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
  <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>

  <!-- CSV helper -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <!-- App CSS/JS -->
  <link rel="stylesheet" href="assets/css/coverage_viewer_v02.css" />
  <script defer src="assets/js/coverage_viewer_v02.js"></script>
</head>
<body>
  <div id="map"></div>
  <div class="drop-hint" id="dropHint">Largue um CSV (agentes) aqui…</div>

<!--
  <div class="panel">
    <h3>Mapa de Cobertura: 3G | 4G | 5G </h3><span>(nPerf tiles)</span>

    <div class="row">
      <label><input type="checkbox" id="chkUnitel"> Unitel</label>
      <label><input type="checkbox" id="chkAfricell"> Africell</label>
    </div>


  <div class="panel">
  <div style="display:flex; align-items:baseline; gap:6px;">
    <h3 style="margin:0;">Mapa de Cobertura: 3G | 4G | 5G</h3>
    <span style="font-size:0.85em; color:#666; font-weight:normal;">
      (nPerf tiles)
    </span>
  </div>

  <div class="row">
    <label style="font-weight:bold; color:#333;">
      <input type="checkbox" id="chkUnitel"> Unitel
    </label>
    <label style="font-weight:bold; color:#333;">
      <input type="checkbox" id="chkAfricell"> Africell
    </label>
  </div>
</div>


    <div class="row">
      <label style="min-width:80px;">Opacidade</label>
      <input type="range" id="opacity" min="0" max="1" step="0.1" value="0.6" style="flex:1;">
    </div>

    <hr>

    <div class="row"><strong>Energia (GeoJSON)</strong></div>
    <div class="row">
      <input type="file" id="energyGeojsonInput" accept=".geojson,.json" />
      <button class="btn" id="clearEnergy">Limpar</button>
    </div>
    <div class="row">
      <label><input type="checkbox" id="unknownAsUnstable"> Assumir “instável” quando sem status</label>
    </div>
    <div class="row">
      <label style="min-width:120px;">Opacidade energia</label>
      <input type="range" id="energyOpacity" min="0" max="1" step="0.05" value="0.45" style="flex:1;">
    </div>
    <div class="row" style="gap:6px;">
      <button class="btn" id="loadDemoEnergy">Carregar demo</button>
    </div>
    <div style="color:#666; font-size:12px; margin-top:-2px;">
      Espera polígonos com <code>properties.grid_status</code> = <em>stable | unstable | offgrid</em>.
    </div>

    <hr>

    <div class="row"><strong>CSV de agentes</strong></div>
    <div class="row">
      <input type="file" id="csvFile" accept=".csv" />
      <button class="btn" id="clearPoints">Limpar pontos</button>
    </div>
    <div style="color:#666; font-size:12px; margin-top:-2px;">
      Auto-detecção: <em>latitude/longitude</em> e nome (ex.: <em>nome, display</em>). O campo
      <code>coverage_best</code> é opcional; se vier vazio, tenta derivar de
      <code>unitel_best</code>/<code>africell_best</code>.
    </div>

    <hr>

    <div class="row" style="gap:6px; flex-wrap:wrap">
      <button class="btn" id="classifyBtn">Classificar Zonas (A–D)</button>
      <button class="btn" id="exportCsvBtn">Exportar CSV</button>
      <button class="btn" id="exportGeojsonBtn">Exportar GeoJSON</button>
    </div>

    <div class="row">
      <label><input type="checkbox" id="toggleZones" checked> Ver cores da Zona (A–D)</label>
    </div>
  </div>
-->

  <!-- PAINEL -->
<div class="panel">
  <div class="titleline">
    <h3>Mapa de Cobertura: 3G | 4G | 5G</h3>
    <small>(nPerf tiles)</small>
  </div>

  <div class="row carriers">
    <label><input type="checkbox" id="chkUnitel"> Unitel</label>
    <label><input type="checkbox" id="chkAfricell"> Africell</label>
  </div>

  <div class="row">
    <label style="min-width:80px;">Opacidade</label>
    <input type="range" id="opacity" min="0" max="1" step="0.1" value="0.6" style="flex:1;">
  </div>

  <hr>

  <div class="row"><strong>Energia (GeoJSON)</strong></div>
  <div class="row">
    <input type="file" id="energyGeojsonInput" accept=".geojson,.json" />
    <button class="btn" id="clearEnergy">Limpar</button>
  </div>
  <div class="row">
    <label><input type="checkbox" id="unknownAsUnstable"> Assumir “instável” quando sem status</label>
  </div>
  <div class="row">
    <label style="min-width:120px;">Opacidade energia</label>
    <input type="range" id="energyOpacity" min="0" max="1" step="0.05" value="0.45" style="flex:1;">
  </div>
  <div class="row" style="gap:6px;">
    <button class="btn" id="loadDemoEnergy">Carregar demo</button>
  </div>
  <div style="color:#666; font-size:12px; margin-top:-2px;">
    Espera polígonos com <code>properties.grid_status</code> = <em>stable | unstable | offgrid</em>.
  </div>

  <hr>

  <div class="row"><strong>CSV de agentes</strong></div>
  <div class="row">
    <input type="file" id="csvFile" accept=".csv" />
    <button class="btn" id="clearPoints">Limpar pontos</button>
  </div>
  <div style="color:#666; font-size:12px; margin-top:-2px;">
    Auto-detecção: <em>latitude/longitude</em> e nome (ex.: <em>nome, display</em>). O campo
    <code>coverage_best</code> é opcional; se vier vazio, tenta derivar de
    <code>unitel_best</code>/<code>africell_best</code>.
  </div>

  <hr>

  <div class="row" style="gap:6px; flex-wrap:wrap">
    <button class="btn" id="classifyBtn">Classificar Zonas (A–D)</button>
    <button class="btn" id="exportCsvBtn">Exportar CSV</button>
    <button class="btn" id="exportGeojsonBtn">Exportar GeoJSON</button>
  </div>

  <div class="row">
    <label><input type="checkbox" id="toggleZones" checked> Ver cores da Zona (A–D)</label>
  </div>
</div>


  <!-- Barra estilo nPerf -->
  <div class="nperf-bar" id="nperfBar">
    <div class="badge" id="lastUpdate">Last update — Unitel: –, Africell: –</div>
    <div class="techs">
      <div class="tech"><span class="dot none"></span><span>Sem</span></div>
      <div class="tech"><span class="dot g2"></span><span>2G</span></div>
      <div class="tech"><span class="dot g3"></span><span>3G</span></div>
      <div class="tech"><span class="dot g4"></span><span>4G</span></div>
      <div class="tech"><span class="dot g5"></span><span>5G</span></div>
    </div>
  </div>

  <!-- Legendas 
  <div class="legend">
    <div><span class="sw unitel"></span>Unitel 4G (nPerf)</div>
    <div><span class="sw africell"></span>Africell 4G (nPerf)</div>
    <div style="margin-top:6px;color:#666;">• Pode arrastar CSV para o mapa</div>
  </div>
   -->

  <div class="legend legend-zones">
    <div style="font-weight:700; margin-bottom:4px;">Círculos (classificação por zona)</div>
    <div><span class="dot-legend green"></span>→ <b>Zona A</b> (energia estável + 4G/5G)</div>
    <div><span class="dot-legend yellow"></span>→ <b>Zona B</b> Cobertura 3G/4G instável e energia intermitente, (ou <b>B*</b> sem confirmação de cobertura)</div>
    <div><span class="dot-legend red"></span>→ <b>Zona C</b> (off-grid / sem cobertura útil)</div>
    <div><span class="dot-legend blue"></span>→ <b>Zona D</b> (comunitária/mesh)</div>

    <hr style="border:none;border-top:1px solid #e4e4e4;margin:8px 0;">
    <div style="font-weight:700; margin-bottom:4px;">Clusters</div>
    <div><span class="cluster-sample zone-a"></span>Cor do cluster = <b>zona predominante</b> dentro do grupo (A/B/C/D).</div>
  </div>
</body>
</html>
