<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>RNT → OSM Digitizer (Aligned Overlay)</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.css" />
  <script src="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.js"></script>
  <style>
    html, body { height: 100%; margin: 0; }
    #map { height: 100%; }
    .panel {
      position: absolute; right: 10px; top: 10px; z-index: 1000;
      background: #fff; padding: 12px; border-radius: 10px; width: 400px;
      box-shadow: 0 8px 30px rgba(2,8,20,.15); font: 13px/1.35 system-ui, sans-serif;
      max-height: calc(100vh - 20px); overflow: auto;
    }
    .panel h3 { margin: 0 0 8px; font-size: 16px; }
    .panel h4 { margin: 14px 0 6px; font-size: 13px; opacity: .85; }
    .row { display: grid; grid-template-columns: 1fr auto; gap: 8px; align-items: center; margin: 6px 0; }
    .row > label { grid-column: 1 / span 2; font-weight: 600; opacity: .85; }
    .row > input[type="text"], .row > input[type="number"], .row > select, .row > textarea {
      grid-column: 1 / span 2; padding: 8px 10px; border-radius: 8px; border: 1px solid #e4e7ec; outline: none;
    }
    .row .btn { padding: 8px 10px; border-radius: 8px; border: 1px solid #d0d5dd; cursor: pointer; background: #f8fafc; }
    .row .btn.primary { background: #0ea5e9; color: #fff; border-color: #0ea5e9; }
    .legend {
      position: absolute; left: 10px; bottom: 10px; z-index: 1000; background: #fff;
      padding: 10px; border-radius: 10px; box-shadow: 0 8px 30px rgba(2,8,20,.15); font: 12px/1.35 system-ui, sans-serif;
    }
    .legend .item { display: flex; align-items: center; gap: 8px; margin: 6px 0; }
    .swatch { width: 14px; height: 14px; border-radius: 4px; border: 1px solid #d0d5dd; }
    .hr { height: 1px; background: #eee; margin: 10px 0; }
  </style>
</head>
<body>
  <div id="map"></div>

  <div class="panel">
    <h3>RNT → OSM Digitizer</h3>
    <div class="row"><label>Overlay the RNT PNG (approximate georeference)</label></div>
    <div class="row"><label>PNG file</label><input id="pngFile" type="file" accept="image/png,image/jpeg" /></div>
    <div class="row"><label>…or Image URL (HTTPS)</label><input id="imgUrl" type="text" placeholder="https://your-server/rnt.png" /><button class="btn" id="btnLoadUrl">Load</button></div>
    <div class="row"><label>Opacity</label><input id="opacity" type="range" min="0.2" max="1" step="0.05" value="0.55"/></div>

    <div class="hr"></div>
    <h4>Digitize features</h4>
    <div class="row"><button class="btn" id="btnAddSub">Add Substation</button><button class="btn" id="btnAddGen">Add Generation</button></div>
    <div class="row"><button class="btn" id="btnDrawLine">Draw Transmission Line</button><button class="btn" id="btnStopDraw">Stop</button></div>

    <div class="hr"></div>
    <h4>Data</h4>
    <div class="row"><button class="btn" id="btnExport">Export GeoJSON</button><button class="btn" id="btnClear">Clear</button></div>
    <div class="row"><label>Import GeoJSON</label><input id="geojsonFile" type="file" accept=".json,.geojson" /></div>
  </div>

  <div class="legend">
    <div style="font-weight:600; margin-bottom:6px">Legend</div>
    <div class="item"><span class="swatch" style="background:#111827"></span> Transmission line</div>
    <div class="item"><span class="swatch" style="background:#16a34a"></span> Zone A site</div>
    <div class="item"><span class="swatch" style="background:#3b82f6"></span> Zone B site</div>
    <div class="item"><span class="swatch" style="background:#f59e0b"></span> Zone C site</div>
    <div class="item"><span class="swatch" style="background:#ef4444"></span> Zone D site</div>
  </div>

  <script>
    const map = L.map('map').setView([-11.2, 17.8], 5);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    const overlayLayer = L.layerGroup().addTo(map);
    let imageLayer = null;

    function loadOverlay(src) {
      const bounds = [[-4.3, 11.6], [-18.1, 24.1]]; // Angola approx NW/SE
      if (imageLayer) overlayLayer.removeLayer(imageLayer);
      imageLayer = L.imageOverlay(src, bounds, { opacity: +document.getElementById('opacity').value }).addTo(overlayLayer);
      map.fitBounds(bounds);
    }

    document.getElementById('pngFile').addEventListener('change', ev => {
      const f = ev.target.files?.[0]; if (!f) return;
      const r = new FileReader();
      r.onload = () => loadOverlay(r.result);
      r.readAsDataURL(f);
    });
    document.getElementById('btnLoadUrl').onclick = () => {
      const u = document.getElementById('imgUrl').value.trim();
      if (u) loadOverlay(u);
    };
    document.getElementById('opacity').addEventListener('input', () => {
      if (imageLayer) imageLayer.setOpacity(+document.getElementById('opacity').value);
    });
  </script>
</body>
</html>
